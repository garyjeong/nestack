# Nestack 프로젝트 요구사항 정의서

## 1. 프로젝트 개요

### 1.1 프로젝트 정체성
**Nestack**: Life-Cycle Mission SaaS for Couples

부부/커플의 생애 주기(결혼, 주택, 출산, 노후)를 하나의 프로젝트로 정의하고, **자산(Finance)** 데이터를 연동하여 게임처럼 미션을 클리어하며 성장하는 '가정 경영 운영체제(OS)'

### 1.2 핵심 3대 테마

#### 1.2.1 미션 기반의 자금 성장 (Quest-Driven Growth)
- 단순한 가계부가 아닌 거대한 목표를 수행 가능한 퀘스트로 분해
- 정부 정책(대출, 청약, 지원금) 학습과 자금 모으기를 미션화
- 메인 목표 → 월별 미션 → 주별 미션 → 일별 미션 구조

#### 1.2.2 프라이버시 존중형 공유 (Privacy-First Sync)
- 서로의 모든 것을 공개하는 피로감 지양
- "공동 목표에 필요한 데이터만" 선택적으로 공유하는 Duo-Sync 기술
- 12자리 랜덤 초대 코드를 통한 가족 계정 연결
- 실시간 데이터 동기화

---

## 2. 플랫폼 및 접근 방식

### 2.1 지원 플랫폼
- **웹 애플리케이션**: MVP의 주요 플랫폼
- **모바일 애플리케이션**: Phase 2 이후 (웹뷰 기반)

### 2.2 외부 서비스 연동
- **오픈뱅킹**: 금융결제원 오픈뱅킹 테스트베드
- **소셜 로그인**: Google (MVP)

---

## 3. 핵심 기능

### 3.1 사용자 인증 및 계정 관리

#### 3.1.1 인증 방식
- **웹**: 이메일/비밀번호 + 소셜 로그인 (MVP: Google)
- **모바일**: 이메일/비밀번호 + 소셜 로그인 + 생체 인증

#### 3.1.2 계정 관리

##### 회원가입
- 이메일 인증 기반 회원가입
- 필수 입력: 이메일, 비밀번호, 이름
- 이메일 중복 확인
- 비밀번호 규칙: 8자 이상, 영문/숫자/특수문자 조합

##### 로그인/로그아웃
- 이메일/비밀번호 로그인
- Google 소셜 로그인
- 자동 로그인 (Remember me)
- 로그아웃 (현재 기기 / 모든 기기)

##### 비밀번호 관리
- 비밀번호 변경 (현재 비밀번호 확인 후 변경)
- 비밀번호 찾기 (이메일 인증 링크 발송)
- 비밀번호 재설정

##### 프로필 관리
- 이름 변경
- 프로필 이미지 설정 (MVP에서 선택적)

##### 회원 탈퇴
- 탈퇴 전 확인 절차 (비밀번호 재입력)
- 탈퇴 시 처리:
  - 가족 그룹에서 자동 탈퇴
  - 오픈뱅킹 연동 해제
  - 개인 데이터 삭제 (또는 일정 기간 보관 후 삭제)
- 탈퇴 후 동일 이메일 재가입 가능

#### 3.1.3 가족 계정 연결 (Duo-Sync)

##### 초대 코드 시스템
- 12자리 랜덤 초대 코드 생성 (영문 대문자 + 숫자 조합)
- 초대 코드 유효 기간: 7일 (만료 후 재발급 필요)
- 초대 코드 재발급: 기존 코드 무효화 후 새 코드 발급
- 하나의 초대 코드로 1명만 초대 가능 (사용 후 자동 만료)

##### 가족 그룹 관리
- 최대 인원: 2명 (MVP 기준, 부부/커플)
- 연결된 사용자 간 동등한 권한
- 가족 그룹 탈퇴 기능
  - 탈퇴 시 본인 데이터는 유지, 공유 설정만 해제
  - 탈퇴 후 미션은 개인 미션으로 전환되거나 삭제 선택
- 가족 구성원 내보내기 기능 (상대방 강제 탈퇴 불가, 본인만 탈퇴 가능)

##### 데이터 공유 범위
- **공유 가능 데이터**:
  - 계좌 목록 (선택한 계좌만)
  - 계좌 잔액
  - 거래 내역 (선택한 계좌의 거래 내역)
- **공유 설정 방식**:
  - 계좌별 공유 여부 설정 (전체 공개 / 잔액만 공개 / 비공개)
  - 미션 생성 시 필요한 데이터 공유 범위 확인 및 동의
  - 공유 설정은 언제든 변경 가능
- **공유 철회**: 공유 해제 시 상대방에게 더 이상 데이터가 표시되지 않음

##### 실시간 동기화
- 실시간 데이터 동기화 기능 제공
- 동기화 대상: 미션 상태 변경, 공유된 금융 데이터 업데이트

### 3.2 미션 시스템

#### 3.2.1 미션 구조
```
메인 목표 (Life-Cycle Stage)
  └─ 월별 미션
      └─ 주별 미션
          └─ 일별 미션
```

#### 3.2.2 미션 타입
- **시스템 제공 미션**: 서비스에서 제공하는 미션 템플릿
- **사용자 커스텀 미션**: 사용자가 직접 생성하는 미션

#### 3.2.3 시스템 제공 미션 목록 (MVP)

##### 결혼 준비
| 미션명 | 설명 | 목표 유형 |
|--------|------|-----------|
| 예식 비용 모으기 | 예식장, 식대, 사회자 등 예식 관련 비용 | 목표 금액 달성 |
| 스드메 비용 모으기 | 스튜디오, 드레스, 메이크업 비용 | 목표 금액 달성 |
| 신혼여행 자금 모으기 | 신혼여행 경비 | 목표 금액 달성 |
| 혼수 준비 자금 | 가전, 가구 등 혼수 비용 | 목표 금액 달성 |
| 신혼집 보증금 모으기 | 전세/월세 보증금 | 목표 금액 달성 |

##### 주택 마련
| 미션명 | 설명 | 목표 유형 |
|--------|------|-----------|
| 청약 통장 준비 | 청약 통장 가입 및 납입 | 목표 금액/횟수 달성 |
| 전세 자금 모으기 | 전세 보증금 마련 | 목표 금액 달성 |
| 주택 매매 자금 모으기 | 주택 구매를 위한 자금 마련 | 목표 금액 달성 |
| 이사 비용 준비 | 이사 및 인테리어 비용 | 목표 금액 달성 |

#### 3.2.4 미션 생성 규칙
- **메인 목표 생성**: 사용자가 시스템 템플릿 선택 또는 커스텀 생성
- **하위 미션 생성**: 메인 목표 생성 시 사용자가 직접 하위 미션 구성
  - 시스템이 추천 하위 미션을 제안할 수 있음 (선택 사항)
- **미션 수정**: 진행 중인 미션도 수정 가능
- **미션 삭제**: 메인 목표 삭제 시 하위 미션 모두 삭제

#### 3.2.5 미션 진행 규칙
- **미션 상태**: 대기, 진행중, 완료, 실패
- **상태 전환 규칙**:
  - 대기 → 진행중: 사용자가 미션 시작 시
  - 진행중 → 완료: 목표 조건 달성 시 (자동 또는 수동 완료 처리)
  - 진행중 → 실패: 기한 초과 시 자동 실패 처리 (설정에 따라 선택 가능)
- **하위 미션 영향**: 하위 미션 실패가 상위 미션에 자동 영향을 주지 않음 (독립적 관리)
- **기한 연장**: 진행 중인 미션의 기한 연장 가능

#### 3.2.6 미션 목표 및 진행률
- **목표 금액 설정**: 미션 생성 시 목표 금액 설정
- **진행률 계산 방식**:
  - 금액 기반: (현재 모은 금액 / 목표 금액) × 100%
  - 연동 계좌의 잔액 증가분 또는 특정 거래를 미션에 수동 연결
- **진행 현황 표시**: 목표 금액, 현재 금액, 남은 금액, 달성률

#### 3.2.7 미션 데이터 연동
- **MVP**: 자산/금융 데이터만 사용
- **확장 기능**: 일정/이벤트 데이터 (Phase 2 이후)

#### 3.2.8 보상 시스템

> **참고**: 보상 시스템은 MVP에서 기본 형태로 제공하며, Phase 4에서 고도화 예정

##### MVP 보상 (기본)
- **미션 완료 뱃지**: 미션 완료 시 뱃지 획득
  - 생애주기별 뱃지 (결혼 준비 마스터, 주택 마련 성공 등)
  - 연속 달성 뱃지 (3개월 연속 미션 완료 등)
- **가족 공동 달성**: 부부가 함께 완료한 미션에 대한 특별 뱃지

##### 확장 보상 (Phase 4 이후)
- 포인트 시스템 (서비스 내 혜택 연동)
- 외부 제휴 리워드 (금융 상품 연계 등)

### 3.3 금융 데이터 연동

#### 3.3.1 오픈뱅킹 연동
- **서비스**: 금융결제원 오픈뱅킹 테스트베드
- **MVP 기능 범위**:
  - 사용자 인증 (OAuth 2.0)
  - 등록 계좌 조회
  - 잔액 조회
  - 거래 내역 조회
- **제외 기능 (MVP)**:
  - 이체 기능 (보안 및 책임 이슈로 MVP에서 제외)

#### 3.3.2 계좌 연동 기능
- **계좌 등록**: 오픈뱅킹 인증 후 계좌 자동 등록
- **계좌 별명 설정**: 사용자가 계좌에 별명 부여 가능
- **계좌 숨김**: 특정 계좌를 목록에서 숨김 처리
- **계좌 동기화**: 수동 새로고침으로 잔액/거래내역 업데이트
- **연동 해제**: 오픈뱅킹 연동 해제 기능

#### 3.3.3 자산 대시보드

##### 표시 항목
- **총 자산 현황**
  - 개인 총 자산 (본인 계좌 합계)
  - 가족 공유 자산 (공유 설정된 계좌 합계)
- **계좌별 잔액**
  - 계좌 목록 및 개별 잔액
  - 은행별/계좌 유형별 그룹핑
- **거래 내역**
  - 최근 거래 내역 목록
  - 수입/지출 분류 (거래 유형 기반 자동 분류)
  - 기간별 조회 (일별, 주별, 월별)
- **미션 연동 현황**
  - 진행 중인 미션 목표 대비 현재 금액
  - 미션별 진행률

##### 필터 및 정렬
- 기간 필터: 오늘, 이번 주, 이번 달, 직접 설정
- 계좌 필터: 특정 계좌만 조회
- 거래 유형 필터: 수입/지출

#### 3.3.4 거래 내역과 미션 연결
- 특정 거래를 미션에 수동 연결하는 기능
- 연결된 거래 금액이 미션 진행률에 반영
- 거래-미션 연결 해제 기능

### 3.4 정부 정책 데이터

#### 3.4.1 데이터 소스
- 공공데이터 포털
- (추가 조사 필요)

#### 3.4.2 데이터 타입
- 대출 정보
- 청약 정보
- 지원금 정보

### 3.5 사용자 시나리오 (User Stories)

#### 3.5.1 회원가입 및 가족 연결

##### US-001: 신규 회원가입
- **사용자**: 신규 사용자
- **목표**: 서비스에 가입하여 계정을 생성한다
- **시나리오**:
  1. 이메일, 비밀번호, 이름을 입력하여 회원가입
  2. 이메일 인증 완료
  3. 로그인 후 서비스 이용 시작

##### US-002: 배우자 초대 및 가족 연결
- **사용자**: 가입된 사용자
- **목표**: 배우자를 초대하여 가족 그룹을 생성한다
- **시나리오**:
  1. 가족 그룹 생성 및 12자리 초대 코드 발급
  2. 초대 코드를 배우자에게 전달
  3. 배우자가 회원가입 후 초대 코드 입력
  4. 가족 그룹 연결 완료, 데이터 공유 설정

#### 3.5.2 오픈뱅킹 연동

##### US-003: 오픈뱅킹 계좌 연동
- **사용자**: 가입된 사용자
- **목표**: 은행 계좌를 연동하여 자산을 관리한다
- **시나리오**:
  1. 오픈뱅킹 인증 시작 (금융결제원 OAuth)
  2. 연동할 은행 및 계좌 선택
  3. 본인 인증 완료
  4. 계좌 목록 및 잔액 자동 등록
  5. 계좌별 공유 설정 (가족에게 공개 여부)

##### US-004: 자산 현황 확인
- **사용자**: 계좌 연동된 사용자
- **목표**: 본인 및 가족의 자산 현황을 확인한다
- **시나리오**:
  1. 대시보드에서 총 자산 확인
  2. 개인 자산 / 가족 공유 자산 구분 확인
  3. 계좌별 잔액 및 거래 내역 조회
  4. 기간별 필터링으로 거래 내역 분석

#### 3.5.3 미션 진행

##### US-005: 시스템 미션 선택 및 시작
- **사용자**: 가족 그룹에 속한 사용자
- **목표**: 시스템 제공 미션을 선택하여 자금 모으기를 시작한다
- **시나리오**:
  1. 미션 템플릿 목록에서 "결혼 준비 - 예식 비용 모으기" 선택
  2. 목표 금액 및 목표 기한 설정
  3. 필요한 데이터 공유 범위 확인 및 동의
  4. 미션 시작 (상태: 진행중)
  5. 월별/주별/일별 하위 미션 구성 (선택)

##### US-006: 미션 진행 및 완료
- **사용자**: 미션 진행 중인 사용자
- **목표**: 미션 목표를 달성하고 완료 처리한다
- **시나리오**:
  1. 대시보드에서 미션 진행률 확인
  2. 거래 내역 중 해당 미션에 연결할 거래 선택
  3. 미션 목표 금액 달성
  4. 미션 완료 처리 (자동 또는 수동)

##### US-007: 커스텀 미션 생성
- **사용자**: 가족 그룹에 속한 사용자
- **목표**: 원하는 목표로 직접 미션을 생성한다
- **시나리오**:
  1. 미션 직접 생성 선택
  2. 미션명, 설명, 목표 금액, 기한 입력
  3. 생애주기 카테고리 선택 (결혼/주택/기타)
  4. 미션 생성 완료 및 시작

#### 3.5.4 실시간 동기화

##### US-008: 가족 간 실시간 데이터 확인
- **사용자**: 가족 그룹에 속한 사용자
- **목표**: 배우자의 자산 변동 및 미션 진행을 실시간으로 확인한다
- **시나리오**:
  1. 배우자가 계좌 잔액 업데이트 (동기화)
  2. 실시간으로 대시보드에 반영 (SSE)
  3. 배우자가 미션 완료 처리
  4. 실시간으로 미션 상태 변경 확인

---

## 4. 보안 및 프라이버시

### 4.1 데이터 보안
- 비밀번호 해싱 (bcrypt)
- JWT 토큰 기반 인증
- HTTPS 통신 필수
- 민감한 데이터 암호화 저장

### 4.2 프라이버시 보호
- Duo-Sync: 미션별 필요한 데이터만 선택적 공유
- 사용자가 공유 범위 확인/수정 가능
- 데이터 공유 이력 추적

### 4.3 오픈뱅킹 보안
- OAuth 2.0 인증
- 토큰 안전 저장
- 정기적인 토큰 갱신

---

## 5. MVP 범위

### 5.1 Phase 1: 웹 기반 MVP (자산 관리 중심)

**핵심 목표**: 가족/커플의 자산 관리를 미션으로 진행하는 시스템 구축

#### 필수 기능
- **사용자 인증**
  - 이메일/비밀번호 인증
  - 구글 소셜 로그인
- **가족 계정 연결 (Duo-Sync)**
  - 12자리 랜덤 초대 코드 생성
  - 초대 코드를 통한 가족 계정 연결
  - 실시간 동기화 (SSE)
- **미션 시스템**
  - 미션 생성 (시스템 제공: 결혼 준비, 주택 마련)
  - 사용자 커스텀 미션 생성
  - 미션 진행 추적 (메인 목표 → 월별 → 주별 → 일별)
  - 미션 상태 관리 (대기, 진행중, 완료, 실패)
- **오픈뱅킹 연동**
  - 금융결제원 오픈뱅킹 테스트베드 연동
  - 계좌 조회
  - 거래 내역 조회
- **자산 관리 대시보드**
  - 가족 전체 자산 현황
  - 미션별 자산 목표 및 진행률
  - 거래 내역 시각화
- **보상 시스템 (기본)**
  - 미션 완료 뱃지
  - 가족 공동 달성 뱃지

#### 제외 사항 (Phase 2 이후)
- 모바일 앱
- 정부 정책 데이터 연동
- 보상 시스템 고도화 (포인트, 외부 제휴)

### 5.2 Phase 2: 모바일 앱 (웹뷰)
- Flutter 웹뷰 구현
- 생체 인증 추가
- 모바일 최적화 UI

### 5.3 Phase 3: 확장 기능
- 추가 생애 주기 단계 (출산, 노후)
- 정부 정책 데이터 연동
- 보상 시스템 고도화 (포인트, 외부 제휴 리워드)
- 고급 분석 기능

---

## 6. 개발 로드맵 (초안)

### 6.1 Phase 1: 기반 구축 (4-6주)
- [ ] 프로젝트 초기 설정
  - [ ] Backend (Nest.js) 프로젝트 생성
  - [ ] Frontend (Vite + React) 프로젝트 생성
  - [ ] PostgreSQL 데이터베이스 설계 및 마이그레이션
  - [ ] Docker 개발 환경 구성
- [ ] 인증 시스템
  - [ ] 이메일/비밀번호 인증
  - [ ] 구글 소셜 로그인
  - [ ] JWT 토큰 관리
- [ ] 가족 계정 연결
  - [ ] 초대 코드 생성/검증
  - [ ] 가족 그룹 관리

### 6.2 Phase 2: 미션 시스템 (4-6주)
- [ ] 미션 데이터 모델 설계
- [ ] 미션 CRUD API
- [ ] 미션 진행 추적 시스템
- [ ] 미션 UI 구현
- [ ] 사용자 커스텀 미션 기능

### 6.3 Phase 3: 금융 데이터 연동 (4-6주)
- [ ] 오픈뱅킹 테스트베드 연동
- [ ] 계좌 정보 동기화
- [ ] 거래 내역 조회
- [ ] 금융 데이터 시각화

### 6.4 Phase 4: 실시간 동기화 (2-3주)
- [ ] Server-Sent Events 구현
- [ ] 실시간 데이터 동기화 로직
- [ ] 프론트엔드 실시간 업데이트

### 6.5 Phase 5: 모바일 앱 (4-6주)
- [ ] Flutter 프로젝트 생성
- [ ] 웹뷰 통합
- [ ] 생체 인증 구현
- [ ] 모바일 최적화 UI

---

## 7. 미결정 사항 (TBD)

### 7.1 기능 관련
- [x] 보상 시스템 기본 설계 (뱃지 - MVP 포함)
- [ ] 보상 시스템 고도화 설계 (포인트, 외부 제휴 - Phase 4)
- [ ] 정부 정책 데이터 소스 확정

### 7.2 기술 관련
- [ ] 프론트엔드 상태 관리 라이브러리 선택
- [ ] 스타일링 라이브러리 선택 (CSS-in-JS, Tailwind 등)
- [ ] 캐시 시스템 선택 (Redis 등)
- [ ] 인프라 최종 결정 (AWS, Fly.io 등)
- [ ] CI/CD 파이프라인 설계

### 7.3 비즈니스 관련
- [ ] 서비스 모델 (구독, 프리미엄 등)
- [ ] 데이터 보관 정책
- [ ] 사용자 약관 및 개인정보 처리방침

---

## 8. 참고 사항

### 8.1 개발 원칙
- MCP 원칙 (Minimal Change Principle) 준수
- Project Rules 우선 참조
- 사용자 승인 기반 실행 정책 준수
- 타입 안정성 우선 (TypeScript)

### 8.2 문서화
- API 문서 (Swagger/OpenAPI)
- 데이터베이스 스키마 문서
- 아키텍처 다이어그램
- 배포 가이드

---

## 문서 버전
- **버전**: 1.3.0
- **작성일**: 2024-12-19
- **최종 수정일**: 2025-01-13
- **변경 사항**:
  - 미션 시스템 상세화 (시스템 제공 미션 목록, 생성/진행 규칙, 진행률 계산 방식)
  - 가족 계정(Duo-Sync) 기능 보완 (초대 코드 정책, 가족 그룹 관리, 데이터 공유 범위)
  - 금융 기능 상세화 (MVP 범위 명확화, 자산 대시보드 표시 항목)
  - 사용자 계정 관리 기능 추가 (회원가입, 비밀번호 관리, 회원 탈퇴)
  - 사용자 시나리오(User Stories) 섹션 추가
  - 보상 시스템 방향성 명시 (MVP: 뱃지, Phase 4: 고도화)
  - 기술적 구현 세부사항 제거 (데이터 모델, API 설계 섹션 삭제)
  - 요구사항 정의서는 비즈니스/기능 요구사항 중심으로 재구성
  - 레벨 시스템 제거
  - 건강 데이터 관련 내용 모두 제거
- **작성자**: Nestack 개발팀
